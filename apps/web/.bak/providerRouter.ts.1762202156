import { GoogleGenerativeAI } from "@google/generative-ai";

/** Basic Gemini text generation (for drills or plans) */
async function runGemini(prompt: string): Promise<string> {
  const key = process.env.GEMINI_API_KEY;
  if (!key) throw new Error("Missing GEMINI_API_KEY");
  const genAI = new GoogleGenerativeAI(key);
  const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-lite" });
  const result = await model.generateContent(prompt);
  const text = result.response?.text();
  if (!text) throw new Error("Empty response from Gemini");
  return text;
}

/** For /api/ai/generate-drill */
export async function runAI(provider: string, prompt: string) {
  return runGemini(prompt);
}

/** For /api/coach/plan */
export async function runPlanAI({
  model,
  messages,
}: {
  model: string;
  messages: { role: "system" | "user" | "assistant"; content: string }[];
}) {
  const flat = messages.map(m => `${m.role.toUpperCase()}: ${m.content}`).join("\n");
  return runGemini(flat);
}
