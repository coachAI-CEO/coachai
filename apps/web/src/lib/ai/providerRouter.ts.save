import OpenAI from "openai";
import { GoogleGenerativeAI } from "@google/generative-ai";

export async function runAI(providerName: string, prompt: string): Promise<string> {
  const provider =
    typeof providerName === "string"
      ? providerName.toUpperCase()
      : process.env.PROVIDER?.toUpperCase();

  if (!provider) throw new Error("No provider specified");
  if (!prompt) throw new Error("No prompt provided");

  // ðŸ§  OpenAI
  if (provider === "OPENAI") {
    const client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY! });
    const res = await client.chat.completions.create({
      model: "gpt-4o-mini",
      messages: [{ role: "user", content: prompt }],
      temperature: 0.7,
    });
    return res.choices[0]?.message?.content || "";
  }

// ðŸ§  Gemini (MakerSuite / Google Cloud)
if (provider === "GEMINI") {
  const key = process.env.GEMINI_API_KEY;
  if (!key) throw new Error("GEMINI_API_KEY missing");

  const genAI = new GoogleGenerativeAI(key, {
    apiEndpoint: "https://generativelanguage.googleapis.com/v1",
  });

  // âœ… Use Gemini 2.5 Flash
  const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });

  const result = await model.generateContent({
    contents: [{ role: "user", parts: [{ text: prompt }] }],
  });

  const text = result?.response?.candidates?.[0]?.content?.parts?.[0]?.text;
  if (!text) throw new Error("Empty response from Gemini");
  return text;
}
