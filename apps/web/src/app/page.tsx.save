import Link from 'next/link'
≈
async function getTeams() {
  const base = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3002'
  const res = await fetch(`${base}/api/teams`, { cache: 'no-store' })
  if (!res.ok) throw new Error('Failed to fetch teams')
  const data = await res.json()
  return data.teams as Array<{
    id: string
    name: string
    ageBand: string
    formation: string | null
    createdAt: string
    club: { name: string }
    _count: { players: number; sessions: number; games: number }
  }>
}

export default async function HomePage() {
  const teams = await getTeams()

  return (
    <main className="container py-8 space-y-8">
      <header className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-semibold">CoachAI — Teams</h1>
          <p className="mt-1 text-sm text-gray-600">Your club teams with quick stats.</p>
        </div>
        <a href="#" className="rounded-xl bg-black px-4 py-2 text-white hover:bg-gray-800">
          + New Session (placeholder)
        </a>
      </header>

      <section className="grid grid-cols-1 gap-5 md:grid-cols-2">
        {teams.map((t) => (
          <a key={t.id} href={`/teams/${t.id}`} className="card p-5 block hover:shadow-md transition">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-lg font-semibold">{t.name}</h2>
                <p className="mt-0.5 text-sm text-gray-500">
                  Club: {t.club?.name ?? '—'} · Age: {t.ageBand} · Formation: {t.formation ?? '—'}
                </p>
              </div>
              <span className="rounded-full border px-3 py-1 text-xs text-gray-600">
                {new Date(t.createdAt).toLocaleDateString()}
              </span>
            </div>

            <div className="mt-4 grid grid-cols-3 gap-2 text-center">
              <div className="rounded-lg bg-gray-50 p-3">
                <div className="text-xl font-semibold">{t._count.players}</div>
                <div className="text-xs text-gray-500">Players</div>
              </div>
              <div className="rounded-lg bg-gray-50 p-3">
                <div className="text-xl font-semibold">{t._count.sessions}</div>
                <div className="text-xs text-gray-500">Sessions</div>
              </div>
              <div className="rounded-lg bg-gray-50 p-3">
                <div className="text-xl font-semibold">{t._count.games}</div>
                <div className="text-xs text-gray-500">Games</div>
              </div>
            </div>
          </a>
        ))}
      </section>
    </main>
  )
}
